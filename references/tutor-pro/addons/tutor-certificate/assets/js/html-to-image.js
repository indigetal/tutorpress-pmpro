(()=>{"use strict";var t=function t(e,n){var r=wp.i18n.__;var a=e||{},o=a.data,i=o===void 0?{}:o;var c=i.message,d=c===void 0?n||r("Something Went Wrong!","tutor-pro"):c;return d};function e(t){return o(t)||a(t)||r(t)||n()}function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function a(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function o(t){if(Array.isArray(t))return i(t)}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}jQuery(document).ready(function(n){var r=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);var a=r?parseInt(r[1]):0;var o=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);var i=/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);var c=wp.i18n,d=c.__,u=c._x,s=c._n,l=c._nx;n("body").append('<svg id="tutor_svg_font_id" width="0" height="0" style="background-color:white;"></svg>');var f=function t(e,r){var a=new XMLHttpRequest;a.open("get","?tutor_action=get_fonts&course_id="+e);a.responseType="text";a.send();a.onloadend=function(){var t=a.response;var e=t.match(/https?:\/\/[^ \)]+/g);var o=0;e.forEach(function(a){var i=new XMLHttpRequest;i.open("get",a);i.responseType="blob";i.onloadend=function(){var c=new FileReader;c.onloadend=function(){t=t.replace(new RegExp(a),c.result);o++;if(o==e.length){n("#tutor_svg_font_id").prepend("<style>".concat(t,"</style>"));r()}};c.readAsDataURL(i.response)};i.send()})}};var p=function t(e){var n=document.createElement("canvas");var r=n.getContext("2d");n.width=e.naturalWidth;n.height=e.naturalHeight;r.drawImage(e,0,0);return n.toDataURL("image/png")};var v=function t(e,n){var r=e.getElementsByTagName("img");var a=0;function o(){if(a>=r.length){n();return}r[a].onload=o;r[a].src=p(r[a]);a=a+1}o()};var g=function e(r,c,u){var s=this;this.reload=function(){window.location.reload()};this.dataURItoBlob=function(t,e){var n=atob(t.split(",")[1]);var r=new ArrayBuffer(n.length);var a=new Uint8Array(r);for(var o=0;o<n.length;o++){a[o]=n.charCodeAt(o)}return new Blob([r],{type:e})};this.store_certificate=function(t,e){var r=tutor_get_nonce_data(true);var a=new FormData;a.append("action","tutor_store_certificate_image");a.append("cert_hash",c);a.append("certificate_image",s.dataURItoBlob(t,"image/jpeg"),"certificate.jpg");a.append(r.key,r.value);n.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:a,processData:false,contentType:false,success:function t(n){var r=(n.data||{}).message;e(n&&n.success,r)},error:function t(){e(false)}})};this.dispatch_conversion_methods=function(t,e){var n=t.getElementsByTagName("body")[0];var r=t.getElementById("watermark");var a=r.offsetWidth;var o=r.offsetHeight;n.style.display="inline-block";n.style.overflow="hidden";n.style.width=a+"px";n.style.height=o+"px";n.style.padding="0px";n.style.margin="0px";var c=t.getElementsByTagName("body")[0];var u={scale:3,letterRendering:true,logging:true,foreignObjectRendering:i,allowTaint:true,useCORS:true,x:0,y:0,width:a,height:o,windowWidth:a,windowHeight:o};v(t,function(){html2canvas(c,u).then(function(t){var n=t.toDataURL("image/jpeg",1);s.store_certificate(n,function(t,n){console.log("Store cert image");!t?alert(n||d("Something Went Wrong","tutor-pro")):0;typeof e=="function"?e(t):0})})})};this.load_certificate_builder=function(t){var e=document.createElement("iframe");e.width="1920";e.height="1080";e.style.position="absolute";e.style.left="-999999px";e.src=t;document.getElementsByTagName("body")[0].appendChild(e)};this.init_render_certificate=function(e){var i={action:"tutor_generate_course_certificate",course_id:r,certificate_hash:c||""};n.ajax({url:window._tutorobject.ajaxurl,type:"POST",data:i,success:function i(c){if(!c.success){tutor_toast(d("Error","tutor-pro"),t(c),"error");return}var u=c.data.certificate_builder_url;if(u){window.tutor_certificate_after_build=function(){return e(true)};s.load_certificate_builder(u);return}var l=c.success?c.data.html:"";var p=document.createElement("iframe");var v=function t(e){e.write(l);e.write(n("<div></div>").append(n("#tutor_svg_font_id").clone()).html());if(a){var r=window.document.createElement("style");r.innerHTML="*{word-spacing:3px !important; letter-spacing:2px !important;}";e.getElementsByTagName("head")[0].appendChild(r)}};if(a||o){p.addEventListener("load",function(){var t=p.contentWindow||p.contentDocument.document||p.contentDocument;t=t.document;v(t);f(r,function(){return s.dispatch_conversion_methods(t,e)})})}else{f(r,function(){var t=p.contentWindow||p.contentDocument.document||p.contentDocument;t=t.document;t.open();v(t);t.close();p.onload=function(){return s.dispatch_conversion_methods(t,e)}})}p.style.position="absolute";p.style.left="-999999px";document.getElementsByTagName("body")[0].appendChild(p)}})}};var m=n(".tutor-certificate-pdf");m.click(function(t){t.preventDefault();var e=n("#tutor-pro-certificate-preview");var r=e.attr("src");var a=e.data("orientation")==="landscape"?"l":"p";var o=e.data("size")||"letter";var i=new jspdf.jsPDF(a,"px",o,true);i.addImage(r,"PNG",0,0,i.internal.pageSize.getWidth(),i.internal.pageSize.getHeight(),undefined,"NONE");i.save("certificate-".concat((new Date).getTime(),".pdf"))});var h=n("#tutor-pro-certificate-download-image");h.click(function(t){t.preventDefault();var e=n("#tutor-pro-certificate-preview");var r=document.createElement("A");r.href=e.attr("src");r.download="certificate-"+(new Date).getTime()+".jpg";document.body.appendChild(r);r.click();document.body.removeChild(r)});var _=n("#tutor-pro-certificate-preview");var y=_.data("course_id");var w=_.data("cert_hash");var b=new g(y,w);if(_.data("is_generated")==="no"){b.init_render_certificate(function(){window.location.replace(_.data("certificate_url"))})}this.PrintDiv=function(){var t=document.querySelector("#div-to-print");if(!t){return}var n=window.open("","_blank","width=800,height=500");var r=n.document;var a=r.createElement("body");a.append.apply(a,e(t.cloneNode(true).childNodes));r.body.replaceWith(a);setTimeout(function(){n.print();n.close()},100)}})})();